<!doctype html>
<html lang="ko" >
<head>
	<title>js customGestureEvent
    </title>
	<meta charset="utf-8">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="shortcut icon" href="http://www.mins01.com/favicon.ico">	
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<script src="/js/ForGoogle.js"></script>
	<!-- google analytics -->
	<script>if(window.ForGoogle){ ForGoogle.analytics() }else{ console.log("failure : ForGoogle.analytics()");}</script>
	

	<!-- jquery 관련 -->
	<!-- <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script> -->

	<!-- 부트스트랩 4 : IE8지원안됨! -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" crossorigin="anonymous"> 
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" crossorigin="anonymous"></script> 
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script> -->
	<!-- vue.js -->
	<!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->
	
	<!-- meta og -->
	
	<meta property="og:title" content="js eventSwipe">
	<meta property="og:description" content="js eventSwipe">
	<meta name="og:image" content="http://www.mins01.com/img/logo.gif">
	<meta property="og:image:width" content="190">
	<meta property="og:image:height" content="70" />
	<meta property="og:site_name" content="js eventSwipe" />
	<meta property="og:type" content="website">
	
	<!-- //meta og -->
	<script src="../CustomPointerEvent.js"></script>
	<script src="../CustomGestureEvent.js"></script>
	<script>
		CustomGestureEvent.active();
	</script>
	<style>
		.event-area-wrap{position: relative;margin:20px auto;  }
		.event-area{background-color: #abc;outline: 2px solid #000; width: 300px;height: 300px;;
			display: flex;
			flex-direction: row;
			flex-wrap: nowrap;
			align-content: center;
			justify-content: center;
			align-items: center;
			margin:0 auto;
			touch-action: none; user-select: none;
		}
		.event-target{background-color: #cba;outline: 2px solid #000; width: 100px;height: 100px;cursor: move}
		.event-target.toggle{background-color: #acb;outline-style: dotted;}
	</style>
	
</head>
<body>
	<div class="container">
        <h1>js CustomGesturesEvent</h1>
        <hr>
		<h2>설명</h2>
		<ul class="list-group">
			<li class="list-group-item">gesture 이벤트를 에뮬레이팅</li>
			<li class="list-group-item">CustomPointerEvent 를 상속 받아는다</li>
		</ul>
		<hr>
		<h2>spec</h2>
		<h3>event type</h3>
		<ul class="list-group">
			<li class="list-group-item">longpress</li>
			<li class="list-group-item">swipeleft</li>
			<li class="list-group-item">swiperight</li>
			<li class="list-group-item">swipeup</li>
			<li class="list-group-item">swipedown</li>
		</ul>
		<h3>event static property</h3>
		<ul class="list-group">
			<li class="list-group-item">longPressTimeout : longpress 이벤트의 발생 시간 (ms). 기본값 0.5초(500ms)</li>
		</ul>
		<h3>event options</h3>
		<ul class="list-group">
			<li class="list-group-item">bubbles : true</li>
			<li class="list-group-item">cancelable : true</li>
			<li class="list-group-item">composed : true</li>
			<li class="list-group-item">detail : this.detail()</li>
		</ul>
		<h3>event.detail</h3>
		<ul class="list-group">
			<li class="list-group-item">target : 최초 이벤트 발생 엘레멘트</li>
			<li class="list-group-item">moveX : x 이동 값</li>
			<li class="list-group-item">moveY : y 이동 값</li>
			<li class="list-group-item">event : original event</li>
		</ul>
		<hr>
		<div class="text-center">
			<button type="button" class="btn btn-success" onclick="CustomGestureEvent.active()" >active</button>
			<button type="button" class="btn btn-danger" onclick="CustomGestureEvent.deactive()" >deactive</button>
		</div>
		<hr>
		<div class="event-area-wrap" id="event-area-wrap" style="width:300px;height:300px;">
			<div class="event-area" id="event-area" style="left:0;top:0;">
				<div class="event-target" id="event-target" style="left:0;top:0; cursor: move">longpress</div>
			</div>
		</div>
		
		<script>
			let eventTarget = document.querySelector('#event-target');

			eventTarget.addEventListener('custompointerdown',function(event){
				event.detail.event.preventDefault();
				event.detail.event.stopPropagation();
				console.log('event',event);
				
				let target = event.target;
				target.style.transform = `translate(${event.detail.moveX}px,${event.detail.moveY}px)`;
			})
			eventTarget.addEventListener('custompointermove',function(event){

				let target = event.target;
				target.style.transform = `translate(${event.detail.moveX}px,${event.detail.moveY}px)`;

			})
			eventTarget.addEventListener('custompointerup',function(event){
				let target = event.target;
				target.style.transform = `translate(0px,0px)`;

				console.log(event.type,event.detail.moveX,event.detail.moveY,event.detail.target.id,event.detail.event);
			})

			eventTarget.addEventListener('longpress',function(event){
				let target = event.target;
				event.detail.event.stopPropagation();
				event.detail.event.preventDefault();
				console.log('longpress',event);
				// alert('longpress')
				target.classList.toggle('toggle');
				
				return false;
			})
		</script>
		<hr>
		<figure>
			<img src="https://cdn.powermockup.com/wireframe-and-mockup-shapes/touch-gestures-screenshot.v1.jpg">
			<figcaption>https://www.powermockup.com/libs/wireframe-and-mockup-shapes/touch-gestures</figcaption>
		</figure>
		<div class="event-area-wrap">
			<div class="event-area"  id="area-swipe-x" style="left:0;top:0; cursor: ew-resize; height: 200px;">
				<div class="event-target" id="target-swipe-x" style="left:0;top:0; cursor: ew-resize;">swipe-x</div>
			</div>
		</div>
		<div class="text-center">
			하늘색 상자 안에서 좌우 이동
		</div>
		<script>
			let areaSwipeX = document.querySelector('#area-swipe-x');
			areaSwipeX._moveX = 0;
			areaSwipeX.addEventListener('pointerdown',function(event){
				event.preventDefault()
			});
			areaSwipeX.addEventListener('custompointermove',function(event){
				let target = this.querySelector('.event-target');
				target.style.transform="translate("+(this._moveX+event.detail.moveX)+"px,0)";
			});
			areaSwipeX.addEventListener('swipeleft',function(event){
				console.log(event.type,event.detail.moveX);
				let target = this.querySelector('.event-target');
				if(event.detail.moveX + this._moveX < -100){
					target.style.transform="translate(-200px,0)";
					this._moveX = -200;
				}else if(event.detail.moveX + this._moveX < 100){
					target.style.transform="translate(0px,0)";
					this._moveX = 0;
				}else{
					target.style.transform="translate("+this._moveX+"px,0)";
				}
			})
			areaSwipeX.addEventListener('swiperight',function(event){
				console.log(event.type,event.detail.moveX);
				let target = this.querySelector('.event-target');
				if(event.detail.moveX + this._moveX > 100){
					target.style.transform="translate(200px,0)";
					this._moveX = 200;
				}else if(event.detail.moveX + this._moveX > -100){
					target.style.transform="translate(0px,0)";
					this._moveX = 0;
				}else{
					target.style.transform="translate("+this._moveX+"px,0)";
				}
			})
		</script>
		<div class="event-area-wrap">
			<div class="event-area"  id="area-swipe-y" style="left:0;top:0; cursor: ns-resize; width:200px; height: 300px;">
				<div class="event-target" id="target-swipe-y" style="left:0;top:0; cursor: ns-resize;">swipe-y</div>
			</div>
		</div>
		<div class="text-center">
			하늘색 상자 안에서 상하 이동
		</div>
		<script>
			let areaSwipeY = document.querySelector('#area-swipe-y');
			areaSwipeY._moveY = 0;
			areaSwipeY.addEventListener('pointerdown',function(event){
				event.preventDefault()
			});
			areaSwipeY.addEventListener('custompointermove',function(event){
				let target = this.querySelector('.event-target');
				target.style.transform="translate(0,"+(this._moveY+event.detail.moveY)+"px)";
			});
			areaSwipeY.addEventListener('swipeup',function(event){
				console.log(event.type,event.detail.moveX,event.detail.moveY);
				let target = this.querySelector('.event-target');
				if(event.detail.moveY + this._moveY < -100){
					target.style.transform="translate(0,-200px)";
					this._moveY = -200;
				}else if(event.detail.moveY + this._moveY < 100){
					target.style.transform="translate(0px,0)";
					this._moveY = 0;
				}else{
					target.style.transform="translate("+this._moveY+"px,0)";
				}
			})
			areaSwipeY.addEventListener('swipedown',function(event){
				console.log(event.type,event.detail.moveX,event.detail.moveY);
				let target = this.querySelector('.event-target');
				if(event.detail.moveY + this._moveY > 100){
					target.style.transform="translate(0,200px)";
					this._moveY = 200;
				}else if(event.detail.moveY + this._moveY > -100){
					target.style.transform="translate(0px,0)";
					this._moveY = 0;
				}else{
					target.style.transform="translate("+this._moveY+"px,0)";
				}
			})
		</script>
		<div class="event-area-wrap">
			<div class="event-area"  id="area-swipe" style="left:0;top:0; cursor: ew-resize; width:300px; height: 300px;">
				<div class="event-target" id="target-swipe" style="left:0;top:0; cursor: ew-resize;">swipe-y</div>
			</div>
		</div>
		<div class="text-center">
			하늘색 상자 안에서 좌우 이동
		</div>
		<script>
			let areaSwipe = document.querySelector('#area-swipe');
			areaSwipe._moveX = 0;
			areaSwipe._moveY = 0;
			areaSwipe.addEventListener('pointerdown',function(event){
				event.preventDefault()
			});
			areaSwipe.addEventListener('custompointermove',function(event){
				let target = this.querySelector('.event-target');
				target.style.transform="translate("+(this._moveX+event.detail.moveX)+"px,"+(this._moveY+event.detail.moveY)+"px)";
			});
			// swipe 는 custompointerup 과 거의 같다. moveX와 moveY가 0일 때 트리거 안하는 것만 차이 있다.
			areaSwipe.addEventListener('swipe',function(event){
				console.log(event.type,event.detail.moveX,event.detail.moveY);
				let target = this.querySelector('.event-target');
				if(event.detail.moveX + this._moveX > 100){
					// target.style.transform="translate(200px,0)";
					this._moveX = 200;
				}else if(event.detail.moveX + this._moveX < -100){
					// target.style.transform="translate(-200px,0)";
					this._moveX = -200;
				}else if(event.detail.moveX + this._moveX < 100){
					// target.style.transform="translate(0px,0)";
					this._moveX = 0;
				}

				if(event.detail.moveY + this._moveY > 100){
					// target.style.transform="translate(200px,0)";
					this._moveY = 200;
				}else if(event.detail.moveY + this._moveY < -100){
					// target.style.transform="translate(-200px,0)";
					this._moveY = -200;
				}else if(event.detail.moveY + this._moveY < 100){
					// target.style.transform="translate(0px,0)";
					this._moveY = 0;
				}
				
				target.style.transform="translate("+this._moveX+"px,"+this._moveY+"px)";
				
			})
			
		</script>
		<div class="event-area-wrap">
			<div class="event-area"  id="area-pinchzoom" style="left:0;top:0; padding:20px; width:100%; touch-action: none;">
				<div class="event-target" style="left:0;top:0; cursor: ew-resize;">PINCH/ZOOM</div>
			</div>
		</div>
		<div class="text-center">
			하늘색 상자 안에서 PINCH/ZOOM (ZOOM IN/OUT)
		</div>
		<script>
			let areaPinchZoom = document.querySelector('#area-pinchzoom');
			areaPinchZoom._scale = 1;
			areaPinchZoom.addEventListener('pinch',function(event){
				console.log(event.type,event.detail.pinchZoom);
				let target = this.querySelector('.event-target');
				let pinchZoom = event.detail.pinchZoom;

				if(Math.abs(pinchZoom)<0.1) return;
				this._scale = Math.max(0.2, areaPinchZoom._scale + pinchZoom/100);
				target.style.transform='scale('+this._scale+')';
			});
			areaPinchZoom.addEventListener('zoom',function(event){
				console.log(event.type,event.detail.pinchZoom);
				let target = this.querySelector('.event-target');
				let pinchZoom = event.detail.pinchZoom;
				if(Math.abs(pinchZoom)<0.1) return;
				
				this._scale = Math.min(2, areaPinchZoom._scale + pinchZoom/100);
				target.style.transform='scale('+this._scale+')';
			});

			
			
		</script>
		<div style="height:100vh"></div>
	</div>
</body>
</html>