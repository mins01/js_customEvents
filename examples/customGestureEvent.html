<!doctype html>
<html lang="ko" >
<head>
	<title>js customGestureEvent
    </title>
	<meta charset="utf-8">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="shortcut icon" href="http://www.mins01.com/favicon.ico">	
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<script src="/js/ForGoogle.js"></script>
	<!-- google analytics -->
	<script>if(window.ForGoogle){ ForGoogle.analytics() }else{ console.log("failure : ForGoogle.analytics()");}</script>
	

	<!-- jquery 관련 -->
	<!-- <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script> -->

	<!-- 부트스트랩 4 : IE8지원안됨! -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" crossorigin="anonymous"> 
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" crossorigin="anonymous"></script> 
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script> -->
	<!-- vue.js -->
	<!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->
	
	<!-- meta og -->
	
	<meta property="og:title" content="js eventSwipe">
	<meta property="og:description" content="js eventSwipe">
	<meta name="og:image" content="http://www.mins01.com/img/logo.gif">
	<meta property="og:image:width" content="190">
	<meta property="og:image:height" content="70" />
	<meta property="og:site_name" content="js eventSwipe" />
	<meta property="og:type" content="website">
	
	<!-- //meta og -->
	<script src="../CustomPointerEvent.js"></script>
	<script src="../CustomGestureEvent.js"></script>
	<script>
		CustomGestureEvent.active();
	</script>
	<style>
		.event-area-wrap{position: relative;margin:20px auto;  }
		.event-area{background-color: #abc;outline: 2px solid #000; width: 300px;height: 300px;;
			display: flex;
			flex-direction: row;
			flex-wrap: nowrap;
			align-content: center;
			justify-content: center;
			align-items: center;
			margin:0 auto;
			touch-action: none; user-select: none;
		}
		.event-target{background-color: #cba;outline: 2px solid #000; width: 100px;height: 100px;cursor: move; 
			display: flex;
			flex-direction: row;
			flex-wrap: nowrap;
			align-content: center;
			justify-content: center;
			align-items: center;
			margin:0 auto;
		}
		.event-target.toggle{background-color: #acb;outline-style: dotted;}

		#area-swipe-sample.on{
			font-weight: bold;
			filter:invert(1)
		}
	</style>
	
</head>
<body>
	<div class="container">
        <h1 class="text-truncate">js CustomGesturesEvent</h1>
        <hr>
		<h2>설명</h2>
		<ul class="list-group">
			<li class="list-group-item">gesture 이벤트를 에뮬레이팅</li>
			<li class="list-group-item">CustomPointerEvent 를 상속 받아는다</li>
		</ul>
		<hr>
		<h2>SPECIFICATION</h2>
		<hr>
		<h3>event type</h3>
		<ul class="list-group">
			<li class="list-group-item">longpress</li>
			<li class="list-group-item">swipeleft</li>
			<li class="list-group-item">swiperight</li>
			<li class="list-group-item">swipeup</li>
			<li class="list-group-item">swipedown</li>
			<li class="list-group-item">swipe</li>
			<li class="list-group-item">pinch</li>
			<li class="list-group-item">zoom</li>
			<li class="list-group-item">pinchzoom</li>
			<li class="list-group-item">rotate</li>
		</ul>
		<h3>event static property</h3>
		<ul class="list-group">
			<li class="list-group-item">CustomGesturesEvent.longPressTimeout : longpress 이벤트의 발생 시간 (ms). 기본값 500 (0.5초)</li>
			<li class="list-group-item">CustomGesturesEvent.longPressCancelThreshold : longpress 진행 중 포인터 이동 시 취소되는 임계점. 기본값 10px</li>
			<li class="list-group-item">CustomGesturesEvent.distanceThreshold : pinch, zoom 발생의 임계점. 0.1px </li>
			<li class="list-group-item">CustomGesturesEvent.rotateThreshold : rotate 발생의 임계점. 0rad (제안 안함) </li>
		</ul>
		<h3>event options</h3>
		<ul class="list-group">
			<li class="list-group-item">bubbles : true</li>
			<li class="list-group-item">cancelable : true</li>
			<li class="list-group-item">composed : true</li>
			<li class="list-group-item">detail : event.detail()</li>
		</ul>
		<h3>event.detail = customePointerEvent.detail 과 같다.</h3>
		<hr>
		<div class="text-center">
			<figure>
				<img src="https://cdn.powermockup.com/wireframe-and-mockup-shapes/touch-gestures-screenshot.v1.jpg" style="max-width: 100%;">
				<figcaption>https://www.powermockup.com/libs/wireframe-and-mockup-shapes/touch-gestures</figcaption>
			</figure>
		</div>
		<hr>
		<div class="text-center">
			<button type="button" class="btn btn-success" onclick="CustomGestureEvent.active()" >active</button>
			<button type="button" class="btn btn-danger" onclick="CustomGestureEvent.deactive()" >deactive</button>
		</div>
		<hr>
		<h2>SMAPLE</h2>
		<hr>
		
		<div class="event-area-wrap">
			<div class="event-area"  id="area-swipe-sample" style="left:0;top:0; cursor: ew-resize; height: 50px; border-radius: 10em; position: relative;">
				<div class="event-target" style="left:5px;top:5px; position: absolute; border-radius: 10em;cursor: ew-resize;  margin:0;height: 40px;width: 40px;"></div>
				<div class="text-center" style="z-index: 3;">밀어서 잠금 해제</div>
			</div>
		</div>
		<div class="text-center">
			밀어서 잠금 해제
		</div>
		<script>
			let areaSwipeSample = document.querySelector('#area-swipe-sample');
			areaSwipeSample._moveDeltaX = 0;
			areaSwipeSample.addEventListener('pointerdown',function(event){
				event.preventDefault()
			});
			areaSwipeSample.addEventListener('custompointermove',function(event){
				let target = this.querySelector('.event-target');
				target.style.transform="translate( clamp(0px,"+(this._moveDeltaX+event.detail.moveDeltaX)+"px,250px),0)";
			});
			areaSwipeSample.addEventListener('swipeleft',function(event){
				console.log(event.type,event.detail.moveDeltaX);
				let target = this.querySelector('.event-target');
				if(event.detail.moveDeltaX + this._moveDeltaX < 250-100){
					target.style.transform="translate(0px,0)";
					this._moveDeltaX = 0;
					this.classList.remove('on')
				}else{
					target.style.transform="translate("+this._moveDeltaX+"px,0)";
				}
			})
			areaSwipeSample.addEventListener('swiperight',function(event){
				console.log(event.type,event.detail.moveDeltaX);
				let target = this.querySelector('.event-target');
				if(event.detail.moveDeltaX + this._moveDeltaX > 250-100){
					target.style.transform="translate(250px,0)";
					this._moveDeltaX = 250;
					this.classList.add('on')
				}else{
					target.style.transform="translate("+this._moveDeltaX+"px,0)";
				}
			})
		</script>
		<hr>
		
		<div class="event-area-wrap" id="event-area-wrap" style="width:300px;height:300px;">
			<div class="event-area" id="event-area" style="left:0;top:0;">
				<div class="event-target" id="event-target" style="left:0;top:0; cursor: move">longpress</div>
			</div>
		</div>
		<div class="text-center">
			길게 누르기, 누르면서 이동시 취소됨
		</div>
		<script>
			let eventTarget = document.querySelector('#event-target');

			eventTarget.addEventListener('custompointerdown',function(event){
				event.detail.event.preventDefault();
				event.detail.event.stopPropagation();
				console.log('event',event);
				
				let target = event.target;
				target.style.transform = `translate(${event.detail.moveDeltaX}px,${event.detail.moveDeltaY}px)`;
			})
			eventTarget.addEventListener('custompointermove',function(event){

				let target = event.target;
				target.style.transform = `translate(${event.detail.moveDeltaX}px,${event.detail.moveDeltaY}px)`;

			})
			eventTarget.addEventListener('custompointerup',function(event){
				let target = event.target;
				target.style.transform = `translate(0px,0px)`;

				console.log(event.type,event.detail.moveDeltaX,event.detail.moveDeltaY,event.detail.target.id,event.detail.event);
			})

			eventTarget.addEventListener('longpress',function(event){
				let target = event.target;
				event.detail.event.stopPropagation();
				event.detail.event.preventDefault();
				console.log('longpress',event);
				// alert('longpress')
				target.classList.toggle('toggle');
				
				return false;
			})
		</script>
		
		<hr>
		
		<div class="event-area-wrap">
			<div class="event-area"  id="area-swipe-x" style="left:0;top:0; cursor: ew-resize; height: 200px;">
				<div class="event-target" id="target-swipe-x" style="left:0;top:0; cursor: ew-resize;">swipe-x</div>
			</div>
		</div>
		<div class="text-center">
			하늘색 상자 안에서 좌우 이동
		</div>
		<script>
			let areaSwipeX = document.querySelector('#area-swipe-x');
			areaSwipeX._moveDeltaX = 0;
			areaSwipeX.addEventListener('pointerdown',function(event){
				event.preventDefault()
			});
			areaSwipeX.addEventListener('custompointermove',function(event){
				let target = this.querySelector('.event-target');
				target.style.transform="translate("+(this._moveDeltaX+event.detail.moveDeltaX)+"px,0)";
			});
			areaSwipeX.addEventListener('swipeleft',function(event){
				console.log(event.type,event.detail.moveDeltaX);
				let target = this.querySelector('.event-target');
				if(event.detail.moveDeltaX + this._moveDeltaX < -100){
					target.style.transform="translate(-200px,0)";
					this._moveDeltaX = -200;
				}else if(event.detail.moveDeltaX + this._moveDeltaX < 100){
					target.style.transform="translate(0px,0)";
					this._moveDeltaX = 0;
				}else{
					target.style.transform="translate("+this._moveDeltaX+"px,0)";
				}
			})
			areaSwipeX.addEventListener('swiperight',function(event){
				console.log(event.type,event.detail.moveDeltaX);
				let target = this.querySelector('.event-target');
				if(event.detail.moveDeltaX + this._moveDeltaX > 100){
					target.style.transform="translate(200px,0)";
					this._moveDeltaX = 200;
				}else if(event.detail.moveDeltaX + this._moveDeltaX > -100){
					target.style.transform="translate(0px,0)";
					this._moveDeltaX = 0;
				}else{
					target.style.transform="translate("+this._moveDeltaX+"px,0)";
				}
			})
		</script>
		<hr>
		
		<div class="event-area-wrap">
			<div class="event-area"  id="area-swipe-y" style="left:0;top:0; cursor: ns-resize; width:200px; height: 300px;">
				<div class="event-target" id="target-swipe-y" style="left:0;top:0; cursor: ns-resize;">swipe-y</div>
			</div>
		</div>
		<div class="text-center">
			하늘색 상자 안에서 상하 이동
		</div>
		<script>
			let areaSwipeY = document.querySelector('#area-swipe-y');
			areaSwipeY._moveDeltaY = 0;
			areaSwipeY.addEventListener('pointerdown',function(event){
				event.preventDefault()
			});
			areaSwipeY.addEventListener('custompointermove',function(event){
				let target = this.querySelector('.event-target');
				target.style.transform="translate(0,"+(this._moveDeltaY+event.detail.moveDeltaY)+"px)";
			});
			areaSwipeY.addEventListener('swipeup',function(event){
				console.log(event.type,event.detail.moveDeltaX,event.detail.moveDeltaY);
				let target = this.querySelector('.event-target');
				if(event.detail.moveDeltaY + this._moveDeltaY < -100){
					target.style.transform="translate(0,-200px)";
					this._moveDeltaY = -200;
				}else if(event.detail.moveDeltaY + this._moveDeltaY < 100){
					target.style.transform="translate(0px,0)";
					this._moveDeltaY = 0;
				}else{
					target.style.transform="translate("+this._moveDeltaY+"px,0)";
				}
			})
			areaSwipeY.addEventListener('swipedown',function(event){
				console.log(event.type,event.detail.moveDeltaX,event.detail.moveDeltaY);
				let target = this.querySelector('.event-target');
				if(event.detail.moveDeltaY + this._moveDeltaY > 100){
					target.style.transform="translate(0,200px)";
					this._moveDeltaY = 200;
				}else if(event.detail.moveDeltaY + this._moveDeltaY > -100){
					target.style.transform="translate(0px,0)";
					this._moveDeltaY = 0;
				}else{
					target.style.transform="translate(0,"+this._moveDeltaY+"px)";
				}
			})
		</script>
		<hr>
		
		<div class="event-area-wrap">
			<div class="event-area"  id="area-swipe" style="left:0;top:0; cursor:move; width:300px; height: 300px;">
				<div class="event-target" id="target-swipe" style="left:0;top:0; cursor:move;">swipe</div>
			</div>
		</div>
		<div class="text-center">
			하늘색 상자 안에서 상하좌우 이동
		</div>
		<script>
			let areaSwipe = document.querySelector('#area-swipe');
			areaSwipe._moveDeltaX = 0;
			areaSwipe._moveDeltaY = 0;
			areaSwipe.addEventListener('pointerdown',function(event){
				event.preventDefault()
			});
			areaSwipe.addEventListener('custompointermove',function(event){
				let target = this.querySelector('.event-target');
				target.style.transform="translate("+(this._moveDeltaX+event.detail.moveDeltaX)+"px,"+(this._moveDeltaY+event.detail.moveDeltaY)+"px)";
			});
			// swipe 는 custompointerup 과 거의 같다. moveDeltaX와 moveDeltaY가 0일 때 트리거 안하는 것만 차이 있다.
			areaSwipe.addEventListener('swipe',function(event){
				console.log(event.type,event.detail.moveDeltaX,event.detail.moveDeltaY);
				let target = this.querySelector('.event-target');
				if(event.detail.moveDeltaX + this._moveDeltaX > 100){
					// target.style.transform="translate(200px,0)";
					this._moveDeltaX = 200;
				}else if(event.detail.moveDeltaX + this._moveDeltaX < -100){
					// target.style.transform="translate(-200px,0)";
					this._moveDeltaX = -200;
				}else if(event.detail.moveDeltaX + this._moveDeltaX < 100){
					// target.style.transform="translate(0px,0)";
					this._moveDeltaX = 0;
				}

				if(event.detail.moveDeltaY + this._moveDeltaY > 100){
					// target.style.transform="translate(200px,0)";
					this._moveDeltaY = 200;
				}else if(event.detail.moveDeltaY + this._moveDeltaY < -100){
					// target.style.transform="translate(-200px,0)";
					this._moveDeltaY = -200;
				}else if(event.detail.moveDeltaY + this._moveDeltaY < 100){
					// target.style.transform="translate(0px,0)";
					this._moveDeltaY = 0;
				}
				
				target.style.transform="translate("+this._moveDeltaX+"px,"+this._moveDeltaY+"px)";
				
			})
			
		</script>
		<hr>
		
		<div class="event-area-wrap">
			<div class="event-area"  id="area-pinchzoom" style="left:0;top:0; padding:20px; width:100%; touch-action: none;">
				<div class="event-target" style="left:0;top:0; ">PINCH/ZOOM</div>
			</div>
		</div>
		<div class="text-center">
			하늘색 상자 안에서 PINCH/ZOOM (ZOOM IN/OUT)
		</div>
		<script>
			let areaPinchZoom = document.querySelector('#area-pinchzoom');
			areaPinchZoom._scale = 1;
			areaPinchZoom.addEventListener('pinch',function(event){
				console.log(event.type,event.detail.distanceDelta);
				let target = this.querySelector('.event-target');
				let distanceDelta = event.detail.distanceDelta;

				if(Math.abs(distanceDelta)<0.1) return;
				this._scale = Math.max(0.2, this._scale + distanceDelta/100);
				target.style.transform='scale('+this._scale+')';
			});
			areaPinchZoom.addEventListener('zoom',function(event){
				console.log(event.type,event.detail.distanceDelta);
				let target = this.querySelector('.event-target');
				let distanceDelta = event.detail.distanceDelta;
				if(Math.abs(distanceDelta)<0.1) return;
				
				this._scale = Math.min(2, this._scale + distanceDelta/100);
				target.style.transform='scale('+this._scale+')';
			});
			areaPinchZoom.addEventListener('pinchzoom',function(event){
				console.log(event.type,event.detail.distanceDelta);
			});
			
		</script>

		<hr>
		
<div class="event-area-wrap">
			<div class="event-area"  id="area-rotate" style="left:0;top:0; padding:20px; width:100%; touch-action: none;">
				<div class="event-target" style="left:0;top:0; ">ROTATE</div>
			</div>
		</div>
		<div class="text-center">
			하늘색 상자 안에서 두개를 터치하고 회전
		</div>
		<script>
			let areaRotate = document.querySelector('#area-rotate');
			areaRotate._rotate = 0;
			areaRotate.addEventListener('rotate',function(event){
				console.log(event.type,event.detail.rotateDelta);
				let target = this.querySelector('.event-target');
				let rotateDelta = event.detail.rotateDelta;
				// console.log(event.detail.rotate);
				this._rotate = this._rotate + rotateDelta
				target.style.transform='rotate('+this._rotate+'rad)';
				
			});
		</script>
		<div style="height:100vh"></div>
	</div>
</body>
</html>