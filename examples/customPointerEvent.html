<!doctype html>
<html lang="ko" >
<head>
	<title>js customPointerEvent
    </title>
	<meta charset="utf-8">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="shortcut icon" href="http://www.mins01.com/favicon.ico">	
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<script src="/js/ForGoogle.js"></script>
	<!-- google analytics -->
	<script>if(window.ForGoogle){ ForGoogle.analytics() }else{ console.log("failure : ForGoogle.analytics()");}</script>
	

	<!-- jquery 관련 -->
	<!-- <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script> -->

	<!-- 부트스트랩 4 : IE8지원안됨! -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" crossorigin="anonymous"> 
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" crossorigin="anonymous"></script> 
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script> -->
	<!-- vue.js -->
	<!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->
	
	<!-- meta og -->
	
	<meta property="og:title" content="js eventSwipe">
	<meta property="og:description" content="js eventSwipe">
	<meta name="og:image" content="http://www.mins01.com/img/logo.gif">
	<meta property="og:image:width" content="190">
	<meta property="og:image:height" content="70" />
	<meta property="og:site_name" content="js eventSwipe" />
	<meta property="og:type" content="website">
	
	<!-- //meta og -->
	<script src="../CustomPointerEvent.js"></script>
	<script>
		CustomPointerEvent.active();
	</script>
	<style>
		.event-area-wrap{position: relative;margin:20px auto; width: 300px;height: 300px;}
		.event-area{background-color: #abc;outline: 2px solid #000; width: 300px;height: 300px;position: absolute; cursor: move;
			display: flex;
			flex-direction: row;
			flex-wrap: nowrap;
			align-content: center;
			justify-content: center;
			align-items: center;
		}
		.event-target{background-color: #cba;outline: 2px solid #000; width: 100px;height: 100px;cursor: move;
			display: flex;
			flex-direction: row;
			flex-wrap: nowrap;
			align-content: center;
			justify-content: center;
			align-items: center;
		}
	</style>
	
</head>
<body>
	<div class="container">
        <h1>js CustomPointerEvent</h1>
        <hr>
		<h2>설명</h2>
		<ul class="list-group">
			<li class="list-group-item">pointerdown,pointermove,pointerup 이벤트에서 x,y 의 변화량을 moveX,moveY(detail 속에)로 제공한다</li>
		</ul>
		<hr>
		<h2>spec</h2>
		<h3>event type</h3>
		<ul class="list-group">
			<li class="list-group-item">custompointerdown</li>
			<li class="list-group-item">custompointermove</li>
			<li class="list-group-item">custompointerup</li>
		</ul>
		<h3>event options</h3>
		<ul class="list-group">
			<li class="list-group-item">bubbles : true</li>
			<li class="list-group-item">cancelable : true</li>
			<li class="list-group-item">composed : true</li>
			<li class="list-group-item">detail : event.detail()</li>
		</ul>
		<h3>event.detail</h3>
		<ul class="list-group">
			<li class="list-group-item">target : 최초 이벤트 발생 엘레멘트</li>
			<li class="list-group-item">event : original event</li>
			<li class="list-group-item">moveX : x 이동량(down 위치 기준 move 위치로 계산)</li>
			<li class="list-group-item">moveY : y 이동량(down 위치 기준 move 위치로 계산)</li>
			<li class="list-group-item">moveDistance : y 이동량(down 위치 기준 move 위치로 계산)</li>
			<li class="list-group-item">duration : 최초 이벤트 후 지난 시간(ms)</li>
			<!-- <li class="list-group-item">moveDeltaX : x 이동 변화량 (move 발생 시 이전 move의 위치 기준)</li>
			<li class="list-group-item">moveDeltaY : y 이동 변화량 (move 발생 시 이전 move의 위치 기준)</li>
			<li class="list-group-item">moveDelta : 이동 변화량 (move 발생 시 이전 move의 위치 기준)</li> -->
			<li class="list-group-item">distanceBetween : 다중 포인터 1,2번째의 거리</li>
			<li class="list-group-item">distanceBetweenDelta : 다중 포인터 1,2번째의 거리 변화량(pinch/zoom 용)</li>
			<li class="list-group-item">rotate : 다중 포인터 1,2번째의 회전 각도(rad)</li>
			<li class="list-group-item">rotateDelta : 다중 포인터 1,2번째의 회전 각도 변화량(rotate 용)(rad)</li>
			<li class="list-group-item">pointerNumber : 다중 포인터 이벤트 수</li>
			<li class="list-group-item">maxPointerNumber : 최대 포인터 이벤트 수 (멀티 터치에서 싱글 터치로 변경 구분)</li>
			<li class="list-group-item">pointers : 다중 포인터 이벤트</li>
			
		</ul>
		<h3>주의</h3>
		<ul class="list-group">
			<li class="list-group-item">
				사용시 브라우저의 터치로 인한 제어를 막아야한다.(특히 모바일 브라우저)<br>
				<code>touch-action:none; user-select:none;</code><br>
				를 사용해서 터치 제어와 컨텍스트메뉴 제어를 막을 수 있다.
			</li>
			
			
		</ul>
		<hr>
		<div class="text-center">
			<button type="button" class="btn btn-success" onclick="CustomPointerEvent.active()" >active</button>
			<button type="button" class="btn btn-danger" onclick="CustomPointerEvent.deactive()" >deactive</button>
		</div>
		<hr>
		<div class="event-area-wrap" id="event-area-wrap">
			<div class="event-area" id="event-area" style="left:0;top:0; touch-action: none;user-select: none;">
				<div class="event-target" id="event-target" style="left:0;top:0; pointer-events: none;">target</div>
			</div>
		</div>
		<div id="text-detail" style="white-space: break-spaces; font-size: 10px;">

		</div>
        
		
		<script>
			let area = document.querySelector('#event-area');
			area._scale = 1;
			area._rotate = 0;
			area.addEventListener('custompointerdown',function(event){
				if(this != event.target){return false;}
				console.log('event',event);
				event.detail.event.preventDefault();
				event.detail.event.stopPropagation();
				console.log(event.type,event.detail.moveX,event.detail.moveY,event.detail.target.id,event.detail.event);

				if(event.detail.event.isPrimary){
					this._left = parseInt(this.style.left,10);
					this._top = parseInt(this.style.top,10);

					this.style.left = 	(this._left+event.detail.moveX)+'px'
					this.style.top = 	(this._top+event.detail.moveY)+'px'
				}
				
				
				document.querySelector('#text-detail').textContent = "# event.type : "+event.type+"\n"+"# event.detail.target.id : "+event.detail.target.id+"\n"+JSON.stringify(event.detail,null,2);
			})
			area.addEventListener('custompointermove',function(event){
				if(this != event.target){return false;}
				console.log(event.type,event.detail.moveX,event.detail.moveY,event.detail.target.id,event.detail.event);

				if(event.detail.pointerNumber==1 && event.detail.maxPointerNumber == 1){
					this.style.left = 	(this._left+event.detail.moveX)+'px'
					this.style.top = 	(this._top+event.detail.moveY)+'px'
				}else if(event.detail.pointerNumber > 1){
					let target = this.querySelector('.event-target');
					let distanceDelta = event.detail.distanceDelta;
					let rotateDelta = event.detail.rotateDelta;
					this._scale = Math.min(2,Math.max(0.2,this._scale + distanceDelta/100));
					this._rotate = this._rotate + rotateDelta
					target.style.transform='scale('+this._scale+') rotate('+this._rotate+'rad)';
				}

				document.querySelector('#text-detail').textContent = "# event.type : "+event.type+"\n"+"# event.detail.target.id : "+event.detail.target.id+"\n"+JSON.stringify(event.detail,null,2);
			})
			area.addEventListener('custompointerup',function(event){
				if(this != event.target){return false;}
				console.log(event.type,event.detail.moveX,event.detail.moveY,event.detail.target.id,event.detail.event);

				document.querySelector('#text-detail').textContent = "# event.type : "+event.type+"\n"+"# event.detail.target.id : "+event.detail.target.id+"\n"+JSON.stringify(event.detail,null,2);
			})

		</script>
		<div style="height:100vh"></div>
	</div>
</body>
</html>