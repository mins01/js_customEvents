<!doctype html>
<html lang="ko" >
<head>
	<title>js CustomGestureEventHandler
    </title>
	<meta charset="utf-8">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="shortcut icon" href="http://www.mins01.com/favicon.ico">	
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<script src="/js/ForGoogle.js"></script>
	<!-- google analytics -->
	<script>if(window.ForGoogle){ ForGoogle.analytics() }else{ console.log("failure : ForGoogle.analytics()");}</script>
	

	<!-- jquery 관련 -->
	<!-- <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script> -->

	<!-- 부트스트랩 4 : IE8지원안됨! -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" crossorigin="anonymous"> 
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" crossorigin="anonymous"></script> 
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script> -->
	<!-- vue.js -->
	<!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->
	
	<!-- meta og -->
	
	<meta property="og:title" content="js CustomGestureEventHandler">
	<meta property="og:description" content="js CustomGestureEventHandler">
	<meta name="og:image" content="http://www.mins01.com/img/logo.gif">
	<meta property="og:image:width" content="190">
	<meta property="og:image:height" content="70" />
	<meta property="og:site_name" content="js CustomGestureEventHandler" />
	<meta property="og:type" content="website">
	
	<!-- //meta og -->
	<!-- <script src="../CustomPointer.js"></script> -->
	<script src="../../js_pointerMeasurer/PointerMeasurer.js"></script>	
	<script src="../CustomPointerEventHandler.js"></script>
	<script src="../CustomGestureEventHandler.js"></script>
	<script>
		// CustomPointerEventHandler.getInstance().debug = true;
		CustomPointerEventHandler.activate();
		// CustomGestureEventHandler.getInstance().debug = true;
		CustomGestureEventHandler.activate();
	</script>
	<style>
		.event-area-wrap{position: relative;margin:20px auto; width: 300px;height: 300px;}
		.event-area{background-color: #abc;outline: 2px solid #000; width: 300px;height: 300px;position: absolute; cursor: move;
			display: flex;
			flex-direction: row;
			flex-wrap: nowrap;
			align-content: center;
			justify-content: center;
			align-items: center;
		}
		.event-target{background-color: #cba;outline: 2px solid #000; width: 100px;height: 100px;cursor: move;
			display: flex;
			flex-direction: row;
			flex-wrap: nowrap;
			align-content: center;
			justify-content: center;
			align-items: center;
		}
		.event-target.on{
			outline-style: dotted;
			background-color: #bca;
		}
	</style>
	
</head>
<body>
	<div class="container">
        <h1>js CustomGestureEventHandler</h1>
        <hr>
		<h2>설명</h2>
		<ul class="list-group">
			<li class="list-group-item">CustomPointerEvent 기반으로 CustomGestureEvent를 발생시킨다.</li>
		</ul>
		<hr>
		<h2>SPECIFICATION</h2>
		<h3>constructor</h3>
		<ul class="list-group">
			<li class="list-group-item">customGestureEventHandler = new CustomGestureEventHandler()</li>
			<li class="list-group-item">CustomGestureEventHandler = static CustomGestureEventHandler.getInstance() // 싱글톤. window 객체 기반을 동작</li>
		</ul>
		<h3>property</h3>
		<ul class="list-group"> 
			<li class="list-group-item">customGestureEventHandler = static CustomGestureEventHandler.instance // 디버깅용</li>
			<li class="list-group-item">bool = customGestureEventHandler.debug // 디버깅용</li>
			<li class="list-group-item">bool = customGestureEventHandler.activated // 동작상태</li>
			<li class="list-group-item">Window|Document|HTMLElement = customGestureEventHandler.listener // 이벤트 적용 위치</li>
			<li class="list-group-item">HTMLElement = customGestureEventHandler.target // 이벤트 발생 HTMLElement</li>

			<li class="list-group-item">Array = customGestureEventHandler.customPointers // coustomPointer 들. 멀티 터치 등에 맞춰서 늘어난다.</li>
			<li class="list-group-item">int = customGestureEventHandler.maxPointerNumber // down 이벤트 후 발생된 포인터 최대 수</li>
			<li class="list-group-item">number = customGestureEventHandler.distanceX // Primary 포인터의 X축 이동 거리</li>
			<li class="list-group-item">number = customGestureEventHandler.distanceY // Primary 포인터의 Y축 이동 거리</li>
			<li class="list-group-item">number = customGestureEventHandler.distance // Primary 포인터의 이동 거리</li>
			<li class="list-group-item">number = customGestureEventHandler.distanceDeltaX // Primary 포인터의 X축 이동 거리 변화량</li>
			<li class="list-group-item">number = customGestureEventHandler.distanceDeltaY // Primary 포인터의 Y축 이동 거리 변화량</li>
			<li class="list-group-item">number = customGestureEventHandler.distanceDelta // Primary 포인터의 이동 거리 변화량</li>

			<li class="list-group-item">number = customGestureEventHandler.distanceBetween // 멀티포인터 1,2번째 사이의 거리</li>
			<li class="list-group-item">number = customGestureEventHandler.distanceBetweenDelta // 멀티포인터 1,2번째 사이의 거리 변화량</li>
			<li class="list-group-item">number = customGestureEventHandler.angleBetween // 멀티포인터 1,2번째 사이의 각도</li>
			<li class="list-group-item">number = customGestureEventHandler.angleBetweenDelta // 멀티포인터 1,2번째 사이의 각도 변화량</li>
			
			<li class="list-group-item">number (ms) = getter customGestureEventHandler.duration // Primary 포인터의 걸린 시간</li>
			<li class="list-group-item">number (px/ms)= getter customGestureEventHandler.velocityX // Primary 포인터의 X축 가속도</li>
			<li class="list-group-item">number (px/ms)= getter customGestureEventHandler.velocityY // Primary 포인터의 Y축 가속도</li>
			<li class="list-group-item">number (px/ms)= getter customGestureEventHandler.velocity // Primary 포인터의 가속도</li>
			
			<li class="list-group-item">true = customGestureEventHandler.bubbles // CustomPointerEvent 발생 시 설정</li>
			<li class="list-group-item">true = customGestureEventHandler.cancelable // CustomPointerEvent 발생 시 설정</li>
			<li class="list-group-item">true = customGestureEventHandler.composed // CustomPointerEvent 발생 시 설정</li>
			



		</ul>
		<h3>method</h3>
		<ul class="list-group">
			<li class="list-group-item">null = customGestureEventHandler.cbPointerdown(event) // pointerdown 이벤트 리스너 등록용 콜백 화살표 함수</li>
			<li class="list-group-item">null = customGestureEventHandler.cbPointermove(event) // pointermove 이벤트 리스너 등록용 콜백 화살표 함수</li>
			<li class="list-group-item">null = customGestureEventHandler.cbPointerup(event) // pointerup 이벤트 리스너 등록용 콜백 화살표 함수</li>
			<li class="list-group-item">null = customGestureEventHandler.cbPointercancel(event) // pointercancel 이벤트 리스너 등록용 콜백 화살표 함수</li>

			<li class="list-group-item">null = customGestureEventHandler.pointerdown(event) // pointerdown 이벤트 처리 메소드</li>
			<li class="list-group-item">null = customGestureEventHandler.pointermove(event) // pointermove 이벤트 처리 메소드</li>
			<li class="list-group-item">null = customGestureEventHandler.pointerup(event) // pointerup 이벤트 처리 메소드</li>
			<li class="list-group-item">null = customGestureEventHandler.pointercancel(event) // pointercancel 이벤트 처리 메소드</li>
			
			<li class="list-group-item">null = customGestureEventHandler.setEvent(event) // 이벤트 기준 내부 변수 계산</li>
			<li class="list-group-item">null = customGestureEventHandler.reset() // 내부 변수 초기화</li>
			
		</ul>
		<hr>
		<div class="text-center mb-1">
			<button type="button" class="btn btn-success" onclick="CustomPointerEventHandler.activate()" >CustomPointerEventHandler.activate</button>
			<button type="button" class="btn btn-danger" onclick="CustomPointerEventHandler.deactivate()" >CustomPointerEventHandler.deactivate</button>
		</div>
		<div class="text-center">
			<button type="button" class="btn btn-success" onclick="CustomGestureEventHandler.activate()" >CustomGestureEventHandler.activate</button>
			<button type="button" class="btn btn-danger" onclick="CustomGestureEventHandler.deactivate()" >CustomGestureEventHandler.deactivate</button>
		</div>
		<hr>
		<div class="event-area-wrap" id="event-area-wrap">
			<div class="event-area" id="event-area" style="left:0;top:0; touch-action: none;user-select: none;">
				<div class="event-target" id="event-target" style="left:0;top:0; ">target</div>
			</div>
		</div>
		

		<h3>gestures</h3>
		<div id="text-gestures" style="white-space: break-spaces; font-size: 8px;">

		</div>
		<h3>detail</h3>
		<div id="text-detail" style="white-space: break-spaces; font-size: 8px;">

		</div>
        
		
		<script>
			let area = document.querySelector('#event-area');
			let target = document.querySelector('#event-target');
			target._x = 0;
			target._y = 0;
			target._scale = 1;
			target._rotate = 0;
			function target_transform(){
				target.style.transform = `translate(${target._x}px,${target._y}px) scale(${target._scale}) rotate(${target._rotate}rad)`;
			}
			function text_gestures(msg){
				text_gestures.msgs.push(msg);
				if(text_gestures.msgs.length>5){
					text_gestures.msgs.shift()
				}
				document.querySelector('#text-gestures').textContent = Array.from(text_gestures.msgs).reverse().join("\n");
			}
			text_gestures.msgs = [];

			target.addEventListener('custompointerdown',function(event){
				console.log(event.type,event.detail);
			})

			target.addEventListener('custompointermove',function(event){
				console.log(event.type,event.detail);
				if(event.detail.pointerNumber == 1 && event.detail.maxPointerNumber == 1){
					target._x = event.detail.distanceX;
					target._y = event.detail.distanceY;
				}
				target_transform();
			})
			target.addEventListener('custompointerup',function(event){
				console.log(event.type,event.detail);
				target._x = 0;
				target._y = 0;
				target_transform();
			})
			target.addEventListener('longpress',function(event){
				console.log(event.type,event.detail);
				text_gestures(event.type)
				target.textContent = event.type;
				target.classList.toggle('on')
				document.querySelector('#text-detail').textContent = JSON.stringify(event.detail,null,2);
			})
			// longpresscancel 사용안함
			// area.addEventListener('longpresscancel',function(event){
			// 	console.log(event.type,event.detail,event.detail.message);
			// 	document.querySelector('#text-detail').textContent = JSON.stringify(event.detail,null,2);
			// })

			target.addEventListener('swipeleft',function(event){
				console.log(event.type,event.detail);
				text_gestures(event.type+" , "+event.detail.distanceX+" , "+event.detail.velocityX)
				document.querySelector('#text-detail').textContent = JSON.stringify(event.detail,null,2);

			})
			target.addEventListener('swiperight',function(event){
				console.log(event.type,event.detail);
				text_gestures(event.type+" , "+event.detail.distanceX+" , "+event.detail.velocityX)
				document.querySelector('#text-detail').textContent = JSON.stringify(event.detail,null,2);
			})
			target.addEventListener('swipeup',function(event){
				console.log(event.type,event.detail);
				text_gestures(event.type+" , "+event.detail.distanceY+" , "+event.detail.velocityY)
				document.querySelector('#text-detail').textContent = JSON.stringify(event.detail,null,2);
			})
			target.addEventListener('swipedown',function(event){
				console.log(event.type,event.detail);
				text_gestures(event.type+" , "+event.detail.distanceY+" , "+event.detail.velocityY)
				document.querySelector('#text-detail').textContent = JSON.stringify(event.detail,null,2);
			})

			target.addEventListener('pinch',function(event){
				console.log(event.type,event.detail);
				text_gestures(event.type+" , "+event.detail.distanceBetweenDelta)
				document.querySelector('#text-detail').textContent = JSON.stringify(event.detail,null,2);

				target._scale = Math.min(2,Math.max(0.2,target._scale + event.detail.distanceBetweenDelta/100));
				target_transform();
			})
			target.addEventListener('zoom',function(event){
				console.log(event.type,event.detail);
				text_gestures(event.type+" , "+event.detail.distanceBetweenDelta)
				document.querySelector('#text-detail').textContent = JSON.stringify(event.detail,null,2);

				target._scale = Math.min(2,Math.max(0.2,target._scale + event.detail.distanceBetweenDelta/100));
				target_transform();
			})
			target.addEventListener('rotate',function(event){
				console.log(event.type,event.detail);
				text_gestures(event.type+" , "+event.detail.angleBetweenDelta)
				document.querySelector('#text-detail').textContent = JSON.stringify(event.detail,null,2);
				target._rotate += event.detail.angleBetweenDelta;
				target_transform();
			})
			
		</script>
		<div style="height:100vh"></div>
	</div>
</body>
</html>